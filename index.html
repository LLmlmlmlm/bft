<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Company Apps</title>
<style>
  body {
    font-family: 'Times New Roman', serif;
    background-color: #d6d39f;
    margin: 0; padding: 0;
  }
  .page { display: none; padding: 20px; }
  .active { display: block; }

  img { width: 350px; display: block; margin: 40px auto; }

  .appOptions, .inventoryOptions {
    display: flex;
    flex-direction: column;
    gap: 20px;
    align-items: center;
    justify-content: center;
  }

  .appOption, .inventoryOption, button {
    width: 160px;
    padding: 10px;
    background: white;
    border: 2px solid black;
    border-radius: 8px;
    box-shadow: 3px 3px 8px rgba(0,0,0,0.2);
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: transform 0.2s, background 0.2s;
    margin: 5px;
  }

  .appOption:hover, .inventoryOption:hover, button:hover {
    transform: scale(1.05);
    background: #f0f0f0;
  }

  table { width: 80%; margin: 20px auto; border-collapse: collapse; background:white; }
  th, td { border: 1px solid black; padding: 8px; text-align: center; }
  th { background-color: #f2f2f2; }

  .topButtons {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 10px 0;
  }

  .qtyControls {
    display: flex;
    justify-content: center;
    gap: 5px;
  }
  .qtyControls input {
    width: 50px;
    text-align: center;
  }
</style>
</head>
<body>

<!-- HOME PAGE -->
<div id="homePage" class="page active">
  <img src="images/bftlogofull.png" alt="Logo">
  <div class="appOptions">
    <div class="appOption" onclick="showPage('startPage')">Invoice App</div>
    <div class="appOption" onclick="showPage('inventoryPage')">Inventory App</div>
  </div>
</div>

<!-- INVOICE APP START PAGE -->
<div id="startPage" class="page">
  <img src="images/bftlogofull.png" alt="Logo">
  <div style="text-align:center;">
    <label for="invoiceId">Invoice ID:</label>
    <input type="text" id="invoiceId" placeholder="e.g. BFT2025-01"><br>
    <label for="storeName">Store Name:</label>
    <input type="text" id="storeName"><br>
    <label for="invoiceDate">Date:</label>
    <input type="date" id="invoiceDate"><br>
    <button onclick="goToTable()">Go</button>
    <button onclick="showPage('homePage')">Main Menu</button>
  </div>
</div>

<!-- INVOICE TABLE PAGE -->
<div id="tablePage" class="page">
  <h2>Invoice Table</h2>
  <div class="topButtons">
    <button onclick="addRow()">Add Row</button>
    <button onclick="generateInvoice()">Done</button>
    <button onclick="showPage('homePage')">Main Menu</button>
  </div>
  <table id="invoiceTable">
    <thead>
      <tr><th>Item</th><th>Description</th><th>Unit Price</th><th>Qty</th><th>Total</th></tr>
    </thead>
    <tbody id="invoiceBody"></tbody>
  </table>
</div>

<!-- INVOICE VIEW PAGE -->
<div id="invoicePage" class="page">
  <div id="invoiceView"></div>
  <button onclick="reset()">Done</button>
  <button onclick="showPage('homePage')">Main Menu</button>
</div>

<!-- INVENTORY MAIN PAGE -->
<div id="inventoryPage" class="page">
  <h2>Inventory</h2>
  <div class="inventoryOptions">
    <div class="inventoryOption" onclick="showInventory('labels')">Labels</div>
    <div class="inventoryOption" onclick="showInventory('tea')">Loose Tea</div>
    <div class="inventoryOption" onclick="showInventory('other')">Other Goods</div>
  </div>
  <div id="inventoryList"></div>
  <button onclick="showPage('homePage')">Main Menu</button>
</div>

<script>
// ---------------- Inventory Setup ----------------
let inventory = JSON.parse(localStorage.getItem("inventory")) || {
  labels: [
    {name: "Round Label", qty: 500},
    {name: "Square Label", qty: 300}
  ],
  tea: [
    {name: "Boreal Berry", qty: 100},
    {name: "Loon Song", qty: 120}
  ],
  other: [
    {name: "Boxes", qty: 200},
    {name: "Tape Rolls", qty: 20}
  ]
};

// ---------------- Page Navigation ----------------
function showPage(id) {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ---------------- Show Inventory with Edit ----------------
function showInventory(type) {
  let listDiv = document.getElementById('inventoryList');
  let items = inventory[type];
  let html = `<h3>${type.charAt(0).toUpperCase()+type.slice(1)}</h3>`;
  html += `<table><tr><th>Item</th><th>Quantity</th><th>Actions</th></tr>`;
  items.forEach((i, idx)=> {
    html += `<tr>
      <td>${i.name}</td>
      <td>
        <div class="qtyControls">
          <button onclick="changeQty('${type}',${idx},-1)">-</button>
          <input type="number" value="${i.qty}" onchange="manualQty('${type}',${idx},this.value)">
          <button onclick="changeQty('${type}',${idx},1)">+</button>
        </div>
      </td>
      <td><button onclick="saveInventory()">Save</button></td>
    </tr>`;
  });
  html += `</table>`;
  listDiv.innerHTML = html;
}

function changeQty(type, idx, delta) {
  inventory[type][idx].qty += delta;
  if(inventory[type][idx].qty < 0) inventory[type][idx].qty = 0;
  saveInventory();
  showInventory(type);
}

function manualQty(type, idx, value) {
  let num = parseInt(value);
  if(isNaN(num) || num < 0) num = 0;
  inventory[type][idx].qty = num;
  saveInventory();
}

function saveInventory() {
  localStorage.setItem("inventory", JSON.stringify(inventory));
}

// ---------------- Update Inventory after invoice ----------------
function updateInventory(itemName, qtyUsed) {
  ['labels','tea','other'].forEach(cat => {
    inventory[cat].forEach(item=>{
      if(item.name === itemName) {
        item.qty -= qtyUsed;
        if(item.qty<0) item.qty=0;
      }
    });
  });
  saveInventory();
}

// ---------------- Invoice App Logic ----------------
let enteredId = '';
let enteredStore = '';
let enteredDate = '';
const itemOptions = ['BFT-Large Bag', 'BFT-Small Bag', 'Other Product'];
const descriptions = ['Boreal Berry','Loon Song','Northern Lights','40Â° Below'];

function goToTable() {
  const idInput = document.getElementById('invoiceId');
  const storeInput = document.getElementById('storeName');
  const dateInput = document.getElementById('invoiceDate');
  if(idInput.value.trim() === '' || storeInput.value.trim() === '') return alert('Enter valid Invoice ID and Store');
  enteredId = idInput.value.trim();
  enteredStore = storeInput.value.trim();
  enteredDate = dateInput.value || new Date().toISOString().split('T')[0];
  showPage('tablePage');
  addRow();
}

function addRow() {
  const tbody = document.getElementById('invoiceBody');
  const row = document.createElement('tr');
  const itemSelect = `<select onchange="updatePrice(this)">${itemOptions.map(o=>`<option>${o}</option>`).join('')}</select>`;
  const descSelect = `<select>${descriptions.map(d=>`<option>${d}</option>`).join('')}</select>`;
  row.innerHTML = `<td>${itemSelect}</td><td>${descSelect}</td><td class="unitPrice">14.00</td>
    <td><input type="number" value="1" min="0" onchange="updateTotal(this)"></td>
    <td class="total">14.00</td>`;
  tbody.appendChild(row);
}

function updatePrice(sel) {
  const row = sel.closest('tr');
  let price = 14; if(sel.value==='BFT-Small Bag') price=8.5; else if(sel.value==='Other Product') price=30;
  row.querySelector('.unitPrice').innerText=price.toFixed(2);
  const qty = parseInt(row.querySelector('input').value)||0;
  row.querySelector('.total').innerText=(qty*price).toFixed(2);
}

function updateTotal(inputEl){
  const row=inputEl.closest('tr');
  const price=parseFloat(row.querySelector('.unitPrice').innerText);
  const qty=parseInt(inputEl.value);
  if(qty===0) row.remove(); else row.querySelector('.total').innerText=(price*qty).toFixed(2);
}

// ---------------- Generate Invoice ----------------
function generateInvoice() {
  const rows = document.querySelectorAll('#invoiceBody tr');
  rows.forEach(row=>{
    const itemName = row.querySelectorAll('select')[1].value; // description
    const qty = parseInt(row.querySelector('input').value);
    updateInventory(itemName, qty);
  });
  alert('Invoice finalized! Inventory updated.');
  document.getElementById('invoiceBody').innerHTML='';
  showPage('homePage');
}

window.onload = () => {
  document.getElementById('invoiceDate').value = new Date().toISOString().split('T')[0];
};
</script>

</body>
</html>

